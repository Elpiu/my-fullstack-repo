<div>
  <div
    class="flex flex-col gap-3 bg-surface-card p-3 rounded-2xl shadow-sm border border-surface transition-all duration-300"
    [class.shadow-md]="newTaskTrack()"
  >
    <div class="flex items-center gap-2">
      <p-button styleClass="!bg-transparent" (onClick)="newTaskTrack.set(!newTaskTrack())">
        <tabler-icon
          [name]="newTaskTrack() ? 'bookmark' : 'bookmark-off'"
          class="w-6 h-6 text-primary"
          [pTooltip]="newTaskTrack() ? 'Save to diary' : 'Don\'t save to diary'"
          tooltipPosition="bottom"
        ></tabler-icon>
      </p-button>

      <div class="flex-1 relative">
        <input
          type="text"
          pInputText
          [(ngModel)]="newTaskTitle"
          (keydown.enter)="addTask()"
          placeholder="Add new task..."
          class="w-full"
        />
      </div>

      <p-button
        [disabled]="!canCreateTask()"
        (onClick)="addTask()"
        styleClass="!w-10 !h-10 !rounded-xl !p-0 flex items-center justify-center"
      >
        <ng-template pTemplate="icon">
          <tabler-icon name="plus" class="w-6 h-6"></tabler-icon>
        </ng-template>
      </p-button>
    </div>

    @if (newTaskTrack()) {
    <div
      class="flex flex-col sm:flex-row gap-3 pt-1 border-t border-surface-100 dark:border-surface-800 animate-in slide-in-from-top-2 fade-in duration-200"
    >
      <div class="flex-1 min-w-0">
        <p-multiSelect
          [options]="categories()"
          [(ngModel)]="selectedCategories"
          optionLabel="label"
          placeholder="Select Category"
          display="chip"
          [showToggleAll]="false"
          selectionLimit="1"
          styleClass="w-full !border-0 !bg-surface-50 dark:!bg-surface-900 !rounded-lg"
          panelStyleClass="max-w-[90vw] sm:max-w-xs"
          appendTo="body"
        >
          <ng-template let-item pTemplate="item">
            <div class="flex items-center gap-2">
              <tabler-icon [name]="item.icon" class="w-5 h-5 text-color-secondary"></tabler-icon>
              <span class="font-medium">{{ item.label }}</span>
            </div>
          </ng-template>

          <ng-template let-value pTemplate="selectedItems">
            @for(item of value; track item.id) {
            <div
              class="inline-flex items-center gap-1 px-2 py-0.5 bg-surface-200 dark:bg-surface-700 rounded-md text-sm mr-1"
            >
              <tabler-icon [name]="item.icon" class="w-4 h-4"></tabler-icon>
              <span>{{ item.label }}</span>
            </div>
            } @if(!value || value.length === 0) {
            <span class="text-color-secondary text-sm pl-1">Select Category</span>
            }
          </ng-template>
        </p-multiSelect>
      </div>

      <div class="flex-1 min-w-0">
        <p-multiSelect
          [options]="tags()"
          [(ngModel)]="selectedTags"
          optionLabel="label"
          placeholder="Add Tags"
          display="chip"
          [showToggleAll]="false"
          styleClass="w-full !border-0 !bg-surface-50 dark:!bg-surface-900 !rounded-lg"
          panelStyleClass="max-w-[90vw] sm:max-w-xs"
          appendTo="body"
        >
          <ng-template let-item pTemplate="item">
            <div class="flex items-center gap-2">
              <i class="pi pi-hashtag text-color-secondary text-xs"></i>
              <span>{{ item.label }}</span>
            </div>
          </ng-template>

          <ng-template let-value pTemplate="selectedItems">
            @for(item of value; track item.id) {
            <span
              class="inline-flex bg-surface-200 dark:bg-surface-700 text-xs px-2 py-1 rounded mr-1"
              >#{{ item.label }}</span
            >
            } @if(!value || value.length === 0) {
            <span class="text-color-secondary text-sm pl-1">Add Tags</span>
            }
          </ng-template>
        </p-multiSelect>
      </div>
    </div>
    }
  </div>
</div>
